<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <script src="js/wangEditor.js"></script>
    <script src="js/jquery.min.js"></script>
</head>
<body>
<button id="uploadArticle" onclick = "doUpload();">发布文章</button>
<div>文章标题
    <input id = "articleTitle" type = "text"/>
    <p id = "testArticleTitle" style = "color: #FF0000;"></p>
</div>
<div id = "editor"></div>
<div id = "testEditor" style = "text-color: #FF0000;"></div>

<script>

    function testEmpty(){
        if($("#articleTitle").val()===""){
            $("#testArticleTitle").append("请输入文章标题！");
            return false;
        }
        else{
            $("#testArticleTitle").html("");
        }
        if ( editor.txt.html()===""){
            $("#testEditor").append("请输入文章标题！");
            return false;
        }
        else{
            $("#testEditor").html("");
        }
        return true;
    }

    function doUpload()
    {
        if (testEmpty()===false){
            return;
        }
        if (localStorage.getItem("userId")==null
            ||localStorage.getItem("userName")==null
            ||localStorage.getItem("passWord")==null){
            alert("没有登陆！");
            return;
        }
        $.ajax({
            type:"post",
            url:"/api/new-article",
            data: {
                authorId: localStorage.getItem("userId"),
                authorName: localStorage.getItem("userName"),
                password: localStorage.getItem("passWord"),

                articleTitle: $("#articleTitle").val(),
                articleIntro: $("#articleIntro").val(),
                articleText: editor.txt.html(),

                moduleId: 2,
            },
            async:true,
            success:function(response){
                // console.log(response);
                if(response.status=="Succeed"){
                    console.log("ok");
                    editor.txt.html("");
                }
                else if(response.status=="FailCheckAuthor"){
                    alert("You are not an author, please apply first!");
                }
            }
        });
    }


    var E = window.wangEditor;
    //这里的id为<div id="editor"中的id.
    var editor = new E('#editor');

    // 关闭粘贴内容中的样式
    editor.customConfig.pasteFilterStyle = false;
    // 忽略粘贴内容中的图片
    editor.customConfig.pasteIgnoreImg = true;
    // 使用 base64 保存图片
    editor.customConfig.uploadImgShowBase64 = true;

    // editor.customConfig.uploadImgMaxSize = 5 * 1024 * 1024; // 将图片大小限制为 3M

    editor.create();

    $(function(){
        $("#articleTitle").change(function(){
            testEmpty();
        });
    });

</script>
</body>
</html>